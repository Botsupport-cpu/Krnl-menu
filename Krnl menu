-- УНИВЕРСАЛЬНОЕ АВТО-МЕНЮ ДЛЯ KRNL
local UIS = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")

-- НАСТРОЙКИ --
local DRAG_SPEED = 0.5

-- ПЕРЕМЕННЫЕ --
local mainGui, speedGui
local dragging = false
local dragInput, dragStart, startPos

-- ФУНКЦИЯ УВЕДОМЛЕНИЙ --
local function ShowNotification(message, color)
    local notify = Instance.new("ScreenGui")
    notify.Name = "Notification"
    notify.Parent = CoreGui

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0.3, 0, 0.08, 0)
    frame.Position = UDim2.new(0.35, 0, 0.1, 0)
    frame.BackgroundColor3 = color or Color3.fromRGB(0, 170, 0)
    frame.BorderSizePixel = 0

    local label = Instance.new("TextLabel")
    label.Text = message
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.new(1, 1, 1)
    label.Font = Enum.Font.GothamBold
    label.Parent = frame
    frame.Parent = notify

    -- АНИМАЦИЯ ПОЯВЛЕНИЯ
    frame.Position = UDim2.new(0.35, 0, -0.1, 0)
    local tweenIn = TweenService:Create(
        frame,
        TweenInfo.new(0.5),
        {Position = UDim2.new(0.35, 0, 0.1, 0)}
    )
    tweenIn:Play()

    -- АВТО-УДАЛЕНИЕ
    task.delay(3, function()
        local tweenOut = TweenService:Create(
            frame,
            TweenInfo.new(0.5),
            {Position = UDim2.new(0.35, 0, -0.1, 0)}
        )
        tweenOut:Play()
        tweenOut.Completed:Connect(function()
            notify:Destroy()
        end)
    end)
end

-- ФУНКЦИЯ ПЕРЕТАСКИВАНИЯ --
local function EnableDrag(frame)
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    UIS.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(
                startPos.X.Scale, 
                startPos.X.Offset + delta.X,
                startPos.Y.Scale, 
                startPos.Y.Offset + delta.Y
            )
        end
    end)
end

-- СОЗДАНИЕ ГЛАВНОГО МЕНЮ --
local function CreateMainMenu()
    local gui = Instance.new("ScreenGui")
    gui.Name = "KRNL_Menu"
    gui.ResetOnSpawn = false
    gui.Parent = CoreGui

    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0.3, 0, 0.4, 0)
    mainFrame.Position = UDim2.new(0.35, 0, 0.3, 0)
    mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    mainFrame.Active = true
    mainFrame.Draggable = false

    -- ЗАГОЛОВОК
    local title = Instance.new("TextLabel")
    title.Text = "KRNL EXECUTOR"
    title.Size = UDim2.new(1, 0, 0.1, 0)
    title.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
    title.TextColor3 = Color3.new(1, 0, 0)
    title.Font = Enum.Font.GothamBold

    -- ПОЛЕ ВВОДА СКРИПТА
    local textBox = Instance.new("TextBox")
    textBox.PlaceholderText = "Введите скрипт здесь..."
    textBox.Size = UDim2.new(0.9, 0, 0.6, 0)
    textBox.Position = UDim2.new(0.05, 0, 0.15, 0)
    textBox.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    textBox.TextColor3 = Color3.new(1, 1, 1)
    textBox.TextXAlignment = Enum.TextXAlignment.Left
    textBox.TextYAlignment = Enum.TextYAlignment.Top
    textBox.MultiLine = true
    textBox.TextWrapped = true

    -- КНОПКА ВЫПОЛНЕНИЯ
    local executeBtn = Instance.new("TextButton")
    executeBtn.Text = "EXECUTE"
    executeBtn.Size = UDim2.new(0.4, 0, 0.1, 0)
    executeBtn.Position = UDim2.new(0.05, 0, 0.8, 0)
    executeBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
    executeBtn.TextColor3 = Color3.new(1, 1, 1)

    -- КНОПКА SPEEDHACK
    local speedBtn = Instance.new("TextButton")
    speedBtn.Text = "SPEEDHACK"
    speedBtn.Size = UDim2.new(0.4, 0, 0.1, 0)
    speedBtn.Position = UDim2.new(0.55, 0, 0.8, 0)
    speedBtn.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
    speedBtn.TextColor3 = Color3.new(1, 1, 1)

    -- СОБИРАЕМ ИНТЕРФЕЙС
    title.Parent = mainFrame
    textBox.Parent = mainFrame
    executeBtn.Parent = mainFrame
    speedBtn.Parent = mainFrame
    mainFrame.Parent = gui

    -- ВКЛЮЧАЕМ ПЕРЕТАСКИВАНИЕ
    EnableDrag(mainFrame)

    -- ФУНКЦИОНАЛ КНОПОК
    executeBtn.MouseButton1Click:Connect(function()
        local script = textBox.Text
        if script and script ~= "" then
            local success, error = pcall(function()
                loadstring(script)()
            end)
            
            if success then
                ShowNotification("✅ Скрипт успешно выполнен!", Color3.fromRGB(0, 170, 0))
            else
                ShowNotification("❌ Ошибка: " .. tostring(error), Color3.fromRGB(170, 0, 0))
            end
        else
            ShowNotification("⚠️ Введите скрипт!", Color3.fromRGB(200, 200, 0))
        end
    end)

    speedBtn.MouseButton1Click:Connect(function()
        if speedGui then
            speedGui.Enabled = not speedGui.Enabled
        else
            CreateSpeedMenu()
        end
    end)

    return gui
end

-- МЕНЮ SPEEDHACK --
local function CreateSpeedMenu()
    local gui = Instance.new("ScreenGui")
    gui.Name = "SpeedHack_Menu"
    gui.ResetOnSpawn = false
    gui.Parent = CoreGui

    local speedFrame = Instance.new("Frame")
    speedFrame.Size = UDim2.new(0.2, 0, 0.15, 0)
    speedFrame.Position = UDim2.new(0.4, 0, 0.5, 0)
    speedFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    speedFrame.Active = true

    local title = Instance.new("TextLabel")
    title.Text = "SPEEDHACK"
    title.Size = UDim2.new(1, 0, 0.3, 0)
    title.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
    title.TextColor3 = Color3.new(1, 0.5, 0)

    local slider = Instance.new("Frame")
    slider.Size = UDim2.new(0.9, 0, 0.2, 0)
    slider.Position = UDim2.new(0.05, 0, 0.4, 0)
    slider.BackgroundColor3 = Color3.fromRGB(60, 60, 70)

    local fill = Instance.new("Frame")
    fill.Size = UDim2.new(0.5, 0, 1, 0)
    fill.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
    fill.Parent = slider

    local valueText = Instance.new("TextLabel")
    valueText.Text = "Speed: 1.0x"
    valueText.Size = UDim2.new(1, 0, 0.3, 0)
    valueText.Position = UDim2.new(0, 0, 0.7, 0)
    valueText.BackgroundTransparency = 1
    valueText.TextColor3 = Color3.new(1, 1, 1)

    -- СБОРКА
    title.Parent = speedFrame
    slider.Parent = speedFrame
    valueText.Parent = speedFrame
    speedFrame.Parent = gui

    -- ПЕРЕТАСКИВАНИЕ
    EnableDrag(speedFrame)

    -- ЛОГИКА СЛАЙДЕРА
    local connection
    slider.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            connection = UIS.InputChanged:Connect(function(move)
                if move.UserInputType == Enum.UserInputType.MouseMovement then
                    local xPos = math.clamp(move.Position.X - slider.AbsolutePosition.X, 0, slider.AbsoluteSize.X)
                    local ratio = xPos / slider.AbsoluteSize.X
                    fill.Size = UDim2.new(ratio, 0, 1, 0)
                    
                    local speed = math.clamp(ratio * 5, 0.1, 5)
                    valueText.Text = string.format("Speed: %.1fx", speed)
                    
                    -- ПРИМЕНЕНИЕ СКОРОСТИ
                    local humanoid = Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
                    if humanoid then
                        humanoid.WalkSpeed = 16 * speed
                    end
                end
            end)
        end
    end)

    slider.InputEnded:Connect(function(input)
        if connection then
            connection:Disconnect()
        end
    end)

    speedGui = gui
    return gui
end

-- АВТОМАТИЧЕСКОЕ ПОЯВЛЕНИЕ МЕНЮ --
task.spawn(function()
    task.wait(2) -- Ждем загрузку игры
    mainGui = CreateMainMenu()
    ShowNotification("KRNL Menu загружен!", Color3.fromRGB(0, 100, 200))
end)

print("Авто-меню активировано!")
