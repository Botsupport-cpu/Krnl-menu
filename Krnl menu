local UIS = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local HTTPService = game:GetService("HttpService")

-- –î–ï–ë–ê–ì –†–ï–ñ–ò–ú --
local DEBUG_MODE = true
local function DebugLog(message)
    if DEBUG_MODE then
        warn("[DEBUG] " .. message)
    end
end

-- –ü–ï–†–ï–ú–ï–ù–ù–´–ï --
local mainGui, speedGui, backdoorGui
local _G.ScriptCache = {}

-- –§–£–ù–ö–¶–ò–Ø –£–í–ï–î–û–ú–õ–ï–ù–ò–ô --
local function ShowNotification(message, color)
    DebugLog("–°–æ–∑–¥–∞—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: " .. message)
    
    local notify = Instance.new("ScreenGui")
    notify.Name = "Notification"
    notify.Parent = CoreGui
    notify.ResetOnSpawn = false

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0.6, 0, 0.08, 0)
    frame.Position = UDim2.new(0.2, 0, 0.1, 0)
    frame.BackgroundColor3 = color or Color3.fromRGB(0, 170, 0)
    frame.BorderSizePixel = 0

    local label = Instance.new("TextLabel")
    label.Text = message
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.new(1, 1, 1)
    label.Font = Enum.Font.GothamBold
    label.TextScaled = true
    label.Parent = frame
    frame.Parent = notify

    -- –ê–ù–ò–ú–ê–¶–ò–Ø
    frame.Position = UDim2.new(0.2, 0, -0.1, 0)
    local tweenIn = TweenService:Create(
        frame,
        TweenInfo.new(0.5),
        {Position = UDim2.new(0.2, 0, 0.1, 0)}
    )
    tweenIn:Play()

    task.delay(3, function()
        local tweenOut = TweenService:Create(
            frame,
            TweenInfo.new(0.5),
            {Position = UDim2.new(0.2, 0, -0.1, 0)}
        )
        tweenOut:Play()
        tweenOut.Completed:Connect(function()
            notify:Destroy()
        end)
    end)
end

-- –ü–†–û–í–ï–†–ö–ê –î–û–°–¢–£–ü–ù–û–°–¢–ò CORE GUI --
local function EnsureCoreGui()
    if not CoreGui then
        DebugLog("CoreGui –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É—é –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø...")
        CoreGui = game:GetService("CoreGui")
    end
    
    if not CoreGui then
        warn("‚ùå FATAL: CoreGui –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!")
        return false
    end
    return true
end

-- –ü–ï–†–ï–¢–ê–°–ö–ò–í–ê–ù–ò–ï --
local function EnableMobileDrag(frame)
    DebugLog("–í–∫–ª—é—á–∞—é –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –¥–ª—è " .. frame.Name)
    
    local touchStartPos, frameStartPos
    
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            touchStartPos = input.Position
            frameStartPos = frame.Position
            DebugLog("–ù–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è")
        end
    end)
    
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            local touch = input
            touch.Changed:Connect(function()
                if touch.UserInputState == Enum.UserInputState.Change then
                    local delta = touch.Position - touchStartPos
                    frame.Position = UDim2.new(
                        frameStartPos.X.Scale, 
                        frameStartPos.X.Offset + delta.X,
                        frameStartPos.Y.Scale, 
                        frameStartPos.Y.Offset + delta.Y
                    )
                end
            end)
        end
    end)
end

-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ --
local function CreateMainMenu()
    DebugLog("–°–æ–∑–¥–∞—é –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é...")
    
    if not EnsureCoreGui() then return end
    
    -- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ –º–µ–Ω—é –µ—Å–ª–∏ –µ—Å—Ç—å
    if mainGui then
        mainGui:Destroy()
    end

    local gui = Instance.new("ScreenGui")
    gui.Name = "Advanced_KRNL_Menu"
    gui.ResetOnSpawn = false
    gui.Parent = CoreGui

    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0.8, 0, 0.6, 0)
    mainFrame.Position = UDim2.new(0.1, 0, 0.2, 0)
    mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    mainFrame.Active = true
    mainFrame.Name = "MainFrame"

    -- –ó–ê–ì–û–õ–û–í–û–ö
    local title = Instance.new("TextLabel")
    title.Text = "ADVANCED EXECUTOR"
    title.Size = UDim2.new(1, 0, 0.1, 0)
    title.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
    title.TextColor3 = Color3.new(1, 0, 0)
    title.Font = Enum.Font.GothamBold
    title.TextScaled = true

    -- –ü–û–õ–ï –í–í–û–î–ê
    local textBox = Instance.new("TextBox")
    textBox.PlaceholderText = "Enter Lua script here..."
    textBox.Size = UDim2.new(0.9, 0, 0.5, 0)
    textBox.Position = UDim2.new(0.05, 0, 0.15, 0)
    textBox.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    textBox.TextColor3 = Color3.new(1, 1, 1)
    textBox.TextXAlignment = Enum.TextXAlignment.Left
    textBox.TextYAlignment = Enum.TextYAlignment.Top
    textBox.MultiLine = true
    textBox.TextWrapped = true

    -- –ö–ù–û–ü–ö–ò
    local buttons = {
        {text = "‚ñ∂ EXECUTE", pos = UDim2.new(0.05, 0, 0.7, 0), color = Color3.fromRGB(0, 170, 0)},
        {text = "‚ö° SPEEDHACK", pos = UDim2.new(0.55, 0, 0.7, 0), color = Color3.fromRGB(0, 100, 200)},
        {text = "üîì BACKDOOR", pos = UDim2.new(0.05, 0, 0.82, 0), color = Color3.fromRGB(120, 0, 200)},
        {text = "üóëÔ∏è CLEAR CACHE", pos = UDim2.new(0.55, 0, 0.82, 0), color = Color3.fromRGB(200, 50, 50)}
    }

    for i, btnData in ipairs(buttons) do
        local button = Instance.new("TextButton")
        button.Text = btnData.text
        button.Size = UDim2.new(0.4, 0, 0.1, 0)
        button.Position = btnData.pos
        button.BackgroundColor3 = btnData.color
        button.TextColor3 = Color3.new(1, 1, 1)
        button.TextScaled = true
        button.Parent = mainFrame
    end

    -- –°–ë–û–†–ö–ê
    title.Parent = mainFrame
    textBox.Parent = mainFrame
    mainFrame.Parent = gui

    -- –í–ö–õ–Æ–ß–ê–ï–ú –ü–ï–†–ï–¢–ê–°–ö–ò–í–ê–ù–ò–ï
    EnableMobileDrag(mainFrame)

    -- –ü–†–û–°–¢–ê–Ø –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨ –î–õ–Ø –¢–ï–°–¢–ê
    local executeBtn = mainFrame:FindFirstChild("TextButton")
    if executeBtn then
        executeBtn.MouseButton1Click:Connect(function()
            DebugLog("–ö–Ω–æ–ø–∫–∞ –Ω–∞–∂–∞—Ç–∞!")
            ShowNotification("‚úÖ –ú–µ–Ω—é —Ä–∞–±–æ—Ç–∞–µ—Ç!", Color3.fromRGB(0, 200, 0))
        end)
    end

    mainGui = gui
    DebugLog("–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å–æ–∑–¥–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ!")
    return gui
end

-- –ü–†–û–°–¢–û–ô SPEEDHACK –ú–ï–ù–Æ --
local function CreateSpeedMenu()
    DebugLog("–°–æ–∑–¥–∞—é –º–µ–Ω—é —Å–∫–æ—Ä–æ—Å—Ç–∏...")
    
    if not EnsureCoreGui() then return end
    
    if speedGui then
        speedGui:Destroy()
    end

    local gui = Instance.new("ScreenGui")
    gui.Name = "Speed_Menu"
    gui.ResetOnSpawn = false
    gui.Parent = CoreGui

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0.6, 0, 0.2, 0)
    frame.Position = UDim2.new(0.2, 0, 0.4, 0)
    frame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    frame.Active = true
    frame.Name = "SpeedFrame"

    local title = Instance.new("TextLabel")
    title.Text = "‚ö° SPEEDHACK"
    title.Size = UDim2.new(1, 0, 0.3, 0)
    title.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
    title.TextColor3 = Color3.new(1, 0.5, 0)
    title.Font = Enum.Font.GothamBold
    title.TextScaled = true

    title.Parent = frame
    frame.Parent = gui

    EnableMobileDrag(frame)
    speedGui = gui
    
    DebugLog("–ú–µ–Ω—é —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω–æ!")
    return gui
end

-- –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –ó–ê–ü–£–°–ö --
DebugLog("–ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞...")
DebugLog("CoreGui: " .. tostring(CoreGui))
DebugLog("Players: " .. tostring(Players))

task.spawn(function()
    DebugLog("–û–∂–∏–¥–∞–Ω–∏–µ 2 —Å–µ–∫—É–Ω–¥—ã...")
    task.wait(2)
    
    DebugLog("–ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–µ–Ω—é...")
    local success, err = pcall(function()
        mainGui = CreateMainMenu()
        if mainGui then
            ShowNotification("üöÄ –ú–µ–Ω—é –∑–∞–≥—Ä—É–∂–µ–Ω–æ! –¢–∞—â–∏—Ç–µ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è", Color3.fromRGB(0, 100, 200))
            DebugLog("–ú–µ–Ω—é —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ –∏ –ø–æ–∫–∞–∑–∞–Ω–æ")
        else
            warn("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –º–µ–Ω—é!")
        end
    end)
    
    if not success then
        warn("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–µ–Ω—é: " .. tostring(err))
        
        -- –ê–í–ê–†–ò–ô–ù–´–ô –†–ï–ñ–ò–ú
        local emergencyGui = Instance.new("ScreenGui")
        emergencyGui.Parent = CoreGui
        
        local emergencyText = Instance.new("TextLabel")
        emergencyText.Text = "‚ùå MENU ERROR\nCheck console (F9)"
        emergencyText.Size = UDim2.new(0.5, 0, 0.2, 0)
        emergencyText.Position = UDim2.new(0.25, 0, 0.4, 0)
        emergencyText.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
        emergencyText.TextColor3 = Color3.new(1, 1, 1)
        emergencyText.Parent = emergencyGui
        
        warn("–ê–≤–∞—Ä–∏–π–Ω–æ–µ –º–µ–Ω—é —Å–æ–∑–¥–∞–Ω–æ")
    end
end)

-- –¢–ï–°–¢–û–í–ê–Ø –ö–ù–û–ü–ö–ê –î–õ–Ø –ü–†–û–í–ï–†–ö–ò --
local testButton = Instance.new("TextButton")
testButton.Text = "üîÑ SHOW MENU"
testButton.Size = UDim2.new(0.2, 0, 0.1, 0)
testButton.Position = UDim2.new(0.4, 0, 0.8, 0)
testButton.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
testButton.TextColor3 = Color3.new(1, 1, 1)
testButton.Parent = CoreGui

testButton.MouseButton1Click:Connect(function()
    DebugLog("–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –º–µ–Ω—é...")
    CreateMainMenu()
end)

print("‚úÖ –°–∫—Ä–∏–ø—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ F9 –¥–ª—è –ª–æ–≥–æ–≤")
